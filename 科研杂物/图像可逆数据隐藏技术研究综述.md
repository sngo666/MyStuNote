# 图像可逆数据隐藏技术研究综述

## 信息隐藏技术分类及特性

信息隐藏主要研究内容是如何将秘密信息进行特殊编码，以形成未授权用户不可识别的密码，从而保证信息安全性的一门技术。
信息隐藏技术主要包括数字水印、信息隐写以及可逆隐藏三个方向。他们之间的联系和区别如图中（原文图1），数字水印更注重研究嵌入对象的鲁棒性，在有损传输的情况下能够保护数字内容的版权安全；信息隐写更加侧重于数据嵌入行为的不可感知性，多用于隐蔽通信；可逆隐藏需要将嵌入的信息完整提取，并且能够保证恢复原始载体。

如图（图2）为信息隐藏技术应用概括的树状图，下面我们简述信息隐藏技术特性。
与传统加密技术所不同的是，信息隐藏技术在不刻意限制和加密资料存取的前提下，保证隐藏的数据不被侵犯和发现，因此要求具备以下特性：

* 透明性（不可感知性）：在原始载体嵌入秘密数据后，这些数据不能在人类感官上被感知到，应当保证嵌入的结果不会给载体带来感知上的失真。
* 鲁棒性（健壮性）：在遭受攻击后，在不产生载体质量明显下降的前提下，提取数据不会因为攻击而丢失。
* 安全性：隐藏数据的算法要能够抵抗恶意攻击，保证受到隐藏的数据不会受到破坏，对于密钥的生产分发和管理环节也同样是出于对安全性的考量。
* 不可检测性：嵌入数据后，不能够被第三方检测到存在嵌入行为。
* 自恢复性：载体在经过变换后可能会受到较大破坏，根据变换后留下的数据片段，能够推出原始的嵌入数据（目前大部分信息隐藏算法并不具备该特性）。

## 可逆数字隐藏技术

### 基本框架

可逆数据隐藏（RDH）技术主要包含嵌入过程和提取过程两个阶段，首先，发送端根据所选用的嵌入算法将秘密数据嵌入到原始载体图像中，然后将包含嵌入数据的载体发送给接受者，接收端再利用相对应的提取算法恢复出嵌入数据和原始图像，这项技术的研究核心是高性能的数据嵌入算法。

### 性能评估

为了客观评价数据嵌入算法的性能，我们引入峰值信噪比（PSNR）以及嵌入率（BPP）两个概念。

* 峰值信噪比

PSNR用于评价嵌入数据后的图像质量。其值越高，说明嵌入算法的性能越好，图像质量也就越好。在图中的公式中，MSE为均方误差，峰值比与原始载体的像素值成正相关，Imax为像素值的最高值，某些情况下也可以直接设置为255。

* 嵌入率

嵌入率为嵌入的比特总数和图像像素总数的比值，当BPP较大时，说明嵌入容量较大，嵌入算法的性能也会越好。

## 典型的RDH算法

最早的可逆数据隐藏方案由Barton在美国提出，迄今为止，已经在加密域，JPEG压缩和空间域提出了许多方案。

在可逆数据隐藏领域，空域图像因其嵌入容量高，视觉质量好且计算复杂度低的优点，被广泛应用。今天主要介绍基于差值扩展（DE），直方图平移（HS），预测误差扩展（PEE），像素值排序（PVO）和插值技术（IT）等几种技术的空域RDH算法。

早期对于RDH的研究，主要使用的是基于无损压缩的方法，主体思想是对图像进行无损压缩以产生冗余空间，再将秘密数据嵌入冗余空间中。在这种模式中，由于位移平面具有非常弱的相关性，一定程度上会限制嵌入容量的大小。对载体图像进行压缩也会产生噪音，引入更大的失真，影响最终图像的质量。

## 基于DE的RDH算法

首次于2003年提出的基于DE的RDH方案将原始载体图像划分为两个相邻像素对，以更好利用像素间的相关性，然后通过可逆整数变换扩展两个像素之间的差值以达成能够将一位秘密数据嵌入到像素对中，这种方法能够使理论上的最大BPP达到0.5。在容量和图像质量远胜于基于LC的RDH方案。目前对基于DE的RDH方案依然在不断深入和改进，当使用四个像素组成一个矢量用以嵌入一个3位秘密数据时，能够支持的理论最大BPP已经达到0.75。在实验（Alattar A M. Reversible watermark using the difference expansion of a generalized integer transform[ J]. IEEE Transactions on Image Processing, 2004, 13(8) : 1147-1156.）中发现，当选择n个像素视为一个向量时，选择的n越大，BPP就会越大，同时造成的图像失真现象也会越严重。

下面简要概括差值扩展的数据嵌入和提取步骤：

1. 首先选择给定像素对(x0, x1)，假设待嵌入的秘密数据为m，m取0或1。
2. 计算x0和x1的平均值L以及差值h，公式为:

> L = (int)((x0 + x1) / 2)  
> h = x1- x0  

3. 将差值h转换为二进制，并左移一位，再将一位秘密数据嵌入其中，生成新的差值h'，该过程可表示为

> h' = 2h + m

4. 根据差值h'和平均值L计算嵌入秘密数据后的像素值，公式为

> x0' = L - (int)(h' / 2)  
> x1' = L + (int)((h' + 1) / 2)  

1. 以上为嵌入过程，接下来是对于秘密数据的提取过程。首先计算含有秘密数据像素对(x0', x1')的平均值和差值。

> L' = (int)((x0' + x1') / 2)  
> h' = x1'- x0'  

1. 将h'转为二进制数，其最低有效位(LSB)即为嵌入的秘密数据，该过程可表示为

> m = LSB(h')

7. 得到原始差值h = (int)(h' / 2) 后，恢复原始像素对(x0, x1)可表示为

> x0 = L' - (int)(h / 2)  
> x1 = L' - (int)((h + 1) / 2)  

由于DE方案的特性，该过程具有计算简单，实现效率高的特点，但是相对而言，对于含有辅助数据的秘密数据来说，容量的限制可能会是主要的缺陷，当嵌入数据不大且载体图像较为平滑时，选用DE方案能取得较好的性能。

## 基于HS的RDH方案

HS是RDH技术中另一个典型算法，该算法主要是通过修改生成的直方图实现可逆数据的嵌入。下面简要介绍由Ni等人于2006年提出的RDH方案（Ni Z C, Shi Y Q, Ansari N, et al. Reversible data hiding[J]IEEE Transactions on Circuits and Systems for Video Technology, 2006, 16(3) : 354-362.）

与之前的方案相比此方案能够有效提高嵌入容量并改善图像质量，主要思想在于对非峰值点进行平移，然后利用峰值点进行秘密数据的嵌入，在该文献中，每个像素点至多修改1，确保嵌入数据之后的图像质量始终高于48dB。然而，由于该方法的数据嵌入容量等于载体图像直方图中峰值点所对应的像素总数，对于直方图比较平坦的像素图片来说，无法找到过于显著的峰值点，因而会导致嵌入容量和图像质量都不太理想。

下面简要概述零点大于峰值点的数据嵌入过程，同DE方案的情境一样，我们假设零点为a，峰值点为b，此时有a>b，并提供待嵌入的秘密数据m取值为0或者1，步骤如下。

1. 在原始载体图像I的直方图中，寻找到一个零点a和一个峰值b。
2. 根据下式进行平移和秘密数据的嵌入，生成嵌入数据之后像素值。(式7)
3. 完成嵌入后，下式为对图像进行嵌入数据的提取。(式8)
4. 根据零点a和峰值b，根据式9对图像进行原始图像的回复。

上述基于HS的数据嵌入和提取过程非常简单，嵌入后的图像质量也相对较高，缺点在于当载体图像没有较为显著的峰值点时，嵌入容量会受到一定的限制。

后来，Fallahpour等提出了基于图像块而不是整个图像的RDH方案。在此方案中，他们选择对原始图像进行不重叠分块，生成每个分块的直方图。然后利用各个图像块的零点和峰值点嵌入秘密数据。  

Lee等提出了利用差值直方图对原先方案进行改进，通过考虑相邻像素值之间的差值以更好利用自然图像的空间相关性，然后，选择在峰值点1和-1嵌入数据，这会使最多一半的图像像素被修改，所以嵌入数据后的图像质量不小于51.14dB，具体步骤如下。

1. 根据 M*N 大小的原始载体图像生成M * (N/2)大小的差值图像D（式10）。
2. 根据生成的差值直方图。同时将差值为2和-2的差值对进行位移以创建空位用于秘密数据的嵌入，该过程如下(式11)。
3. 遵循式12中的数据嵌入规律，完成对于秘密数据m的嵌入，m的取值范围为0或1.
4. 以上完成了对于秘密数据的嵌入，下面 简要概述对于数据的提取过程。现根据M * N大小的嵌入秘密数据后的图像S，生成M * (N/2)大小的差值图像D，如式13所示。
5. 根据式13，完成对于嵌入数据的提取。
6. 最后根据式14完成对于原始图像像素的逐个恢复。

与原始的基于HS的方案相比，嵌入性能得到了明显的提升，但是嵌入容量和嵌入数据后生成的图像质量仍待进一步提升。后续对于HS方案的改进如基于二维差值直方图修正的RDH方案，多重直方图修正和减少直方图中无效像素移位等提供了更好的性能。

## 基于PEE的RDH算法

基于预测误差扩展的RDH档案最早由Thodi等于2007年提出（ Thodi D M, Rodriguez J J. Expansion embedding techniques for reversible watermarking[ J]. IEEE Transactions on Image Processing, 2007, 16(3) : 721-730.）。该方案中首先生成预测误差直方图（PEH），然后在PEH中嵌入秘密数据。在传统的DE方案中，像素对的差值用于扩展嵌入秘密数据，其最大BPP为0.5。在PEE方案中预测误差（即像素值和预测值之间的差值）用于扩展嵌入，可将一个比特的数值嵌入到一个像素中，也就是说其BPP最大可达1。与DE方案不同，PEE利用了较大邻域的局部相关性。由于预测误差值的特性使其分布相较于图像像素值更加紧凑，PEH分布更加尖锐，失真也就越小。这是其优于ED和HS方案所在。

### 基于一维PEH的RDH方案

本次简要概述基于一维PEH和二维PEH的RDH方案，在一维PEH中主要包含PEH生成以及对PEH修改两个部分。常用的像素值预测方法有梯度调整预测，中值边缘预测和菱形预测等，总体上来说梯度调整预测方法具有更好的性能。

PEH的生成过程如图5所示，首先经过特定扫描器对原始载体进行扫描并且收集成一位序列{x0, x1……}，接着使用预测期预测每个xi，预测值为(x^)i，接着我们计算预测误差ei= xi-(x^)i, 得到预测序列(e1,e2……)，根据预测误差生成的频率生成误差预测直方图，接下来就是通过扩展和移位修改预测误差直方图以达到嵌入秘密数据的目的。
预测器：一种基于神经网络的编码方式，通过基于图象实例的训练,可以处理一些线性预测方法所不能处理的高阶特征以及非线性相关性,且提出根据不同图象的信息和要求进行人为分块,以达到更好的编码效果。

1. 一维秘密数据嵌入规则如图6所示，我们对于扩展和移位的规则如下（式16）。其中T为预定义的阈值，m为待嵌入的秘密数据，取值为0或者1，在[-T, T)中的差值被扩展用于嵌入秘密数据，在区间外的数据被移位用于创建空位以确保可逆性。最后应用(x~)i = (x^)i + e'i生成嵌入后的秘密数据。
2. 接下来是对于秘密数据的提取，恢复原始误差ei可以表示为下式所示（式17），当(e~)i出于[-2T, 2T)时，它的最低有效位LSB即为嵌入的秘密数据位，即m=LSB(e~)。最后我们使用xi=(x^i)+ei，恢复原始像素值。

相较于之前的RDH方案，该方案具有更好的性能，该方案的性能依赖于像素值预测的准确性，预测值越精确，生成的直方图就越尖锐，后续的改进方案如采用自适应PEH等进一步提高了性能。

### 基于二维PEH的RDH方案

基于一维PEH的方案没有充分利用预测误差间的相关性，使得图像冗余没有被充分使用，实际上，相邻预测误差间往往是高度相关的。因此，有研究人员提出了基于二维PEH的RDH方案。
在该方案中，首先将每两个相邻的预测误差视为一对，生成一个由预测误差对组成的序列，然后通过扩展和移位二维PEH实现数据嵌入。图中展示了当T=1时对于二维PEH中第一象限的秘密数据嵌入规则。
后续的研究中发现，对于该嵌入规则将(0, 0)映射到(1, 1)所带来的失真最大，其值为2，一些提出的方案如将(0, 0)以尽可能在失真方向较小的方向上嵌入秘密数据，以及使用自适应的二维映射来自适应地确定二维直方图的修改方式，从总体上提升了算法性能。

## 基于PVO的RDH算法

像素值排序从PEE发展而来的一种RDH技术，最早是由Li等于2013年提出，主要思想是首先将载体图像划分为互不重叠的分块，对每个分块中的像素值进行升序排序，然后在最大值和最小值之间采用PEE嵌入秘密数据。完成嵌入后，每个分块中的像素值顺序保持不变，确保了算法的可逆性。实验结果表明，在低嵌入容量下，基于PVFO方案的算法性能优于一些基于PEE的方案，但对于纹理丰富的图像来说则相反。
通过将PVO与PEE相结合，可以减少移位像素的数量，从而提升图像质量。对于每个分块，使用分块中第二大的像素值来预测最大像素值，用第二小的像素值预测最小像素值，然后将预测误差1和-1分别用于扩展嵌入数据，嵌入和提取过程如下：

1. 将载体图像划分成互不重叠的大小相同的分块，对于包含n个像素的分块X，升序其像素值(x1,x2,x3……)得到(xσ(1), xσ(2), xσ(n))其中, σ:{1,2,…,n} → {1,2,…,n} 是单射。若 xσ(i) = xσ(j) 且 i < j ,则 xσ(1) ≤ xσ(2) ≤ … ≤ xσ(n), σ(i) < σ(j)。
2. 用该分块的第二大像素值xσ(n -1)来预测最大像素值xσ(n)，则预测误差为

> emax = xσ(n) - xσ(n -1)

3. 预测误差的扩展和移位规则可表示为下式(式19)。其中m为嵌入数据。
4. 嵌入数据后的像素值可表示为式20。
5. 以下为对于秘密数据的提取过程，将嵌入秘密数据后的图像划分为互不重叠大小下相同的分块，对于包含n个像素的分块Y，,升序排序其像素值 (y1 ,y2 ,…,yn ) ,得到 (yσ(1) ,yσ(2) ,…,yσ(n))。
6. 根据式21求出预测误差。
7. 对于1或2范围内的预测误差，进行式22的秘密数据提取。
8. 如式23，完成对于原始图像数据的恢复。

该方案在低嵌入率时具有更高的PSNR，然而，该方案仅在一个方向上进行预测误差扩展以嵌入秘密数据，极大限制了容量，在后来的改进中，通过考虑最大像素值和第二大像素值的像
素位置（式24）,可以将秘密数据嵌入到最大像素值等于第二大像素值的分块中以充分利用平滑块。然后如式25所示,预测误差1和0用于扩展嵌入秘密数据提升了嵌入容量。

但是，在深入研究该方案之后，发现该方案对于每个分块中最大和最小预测误差的修改是独立进行的，这使得性能不一定是最优化的。后续的优化方案如基于平滑图像块的预测误差生成二维直方图，优化了嵌入性能，以及使用第三大像素和第三小像素来预测的PVO方案，还有基于位置的LPVO (location-based pixel-value-ordering) 方案。总体来说，若对于嵌入容量的需求不高，且需要生成质量较高的图像，选择PVO方案是很好的选择。

## 基于IT的RDH算法

相较于传统的RDH算法，基于插值技术的RDH算法具有单层嵌入容量较大，图像质量相对较高的优点，该算法的主要思想是利用原始像素值作为参考，通过插值算法来预测新像素值。
在执行对于秘密数据的嵌入过程中，秘密数据仅被嵌入到插值像素中，插值图像中的原始像素值不变。而在提取阶段，只需要对嵌入秘密数据后的图像进行采样即可完成提取。

在处理原始图像的过程中，一副N*N的图像首先被采样生成(N/2) * (N/2)大小的图像，再使用插值算法生成大小为N * N的图像，在原始图像上进行直接插值也是可以的，不过现有的算法基本都是基于采样后的图片进行嵌入操作的，以方便评估算法的性能。

到目前为止，基于IT方案的RDH算法已经延伸出很多种类。如最近邻插值(NNI)，双线性插值(BI)等，NNI通过选用原始图像中最近邻点生成相应的插值像素，但是这样通常会受到混叠效应的影响。(混叠效应：高于采样频率一半的高频信号被映射到信号的低频部分，与原有低频信号叠加，对信号的完整性和准确性产生影响)而BI方法通过对4个最近的相邻原始像素进行加权计算生成相应的插值像素,与 NNI方法相比,该方法生成的图像外观更平滑,视觉质量更好。

2009年提出的邻域均值插值方法(NMI),通过计算相邻像素值的平均值产生插值像素,然后通过计算插值像素与一个原始像素间的差值以在插值像素中嵌入相应位数的秘密数据。下面简要概述该方法的数据提取和嵌入过程。

1. 如图中对原始图像使用NMI插值算法，生成插值图像。（式26）
2. 并根据下式（式27）计算插值像素与原始像素I(0, 0)间差值的绝对值。
3. 根据计算出的差值来确定每个插值像素可嵌入的秘密数据长度。(式28)
4. 取n1、n2和n3位秘密数据并分别转换为十进制V1、V2和V3 。
5. 计算嵌入秘密数据之后的像素值（式29）
6. 完成秘密数据的嵌入阶段后，接下来是数据提取阶段。仅需要通过嵌入后的图像便可以提取数据并且恢复图像，过程参考（式30）
7. 将提取的数据 V1 、V2 和 V3 分别转换为n1 、n2 和 n3 位二进制数据,即可得到嵌入的秘密数据。

大量实验表明该方法提供的BPP最大能达到1.76该方法在计算差值时仅局限在一个 2* 2 的分块中,限制了嵌入容量，大于NNI和BI方案。后来提出的基于邻域像素插值（INP）方案，计算每个 3 *3 重叠分块中 4 个原始像素的最大值,然后通过计算每个插值像素与最大值间的差值来确定可嵌入的秘密数据量，BPP最高可达2.27，产生比NNI、BI和NMI更高的PSNR。基于增强邻域均值插值（ENMI）采用 4 个最接近的原始像素的平均值替代NMI 中对角插值像素的计算,提升了图像质量。而改进的邻域均值插值（MNMI）相较于 NMI 方法,该方法在计算水平插值像素时,其左右相邻像素被赋予更多权重,在计算垂直插值像素时,上下相邻像素被赋予更多权重比ENMI 和 MNMI 方法能够获得更高的图像质量。

总体而言，基于IT方案的RDH算法能够显著提升嵌入容量，在需要大容量的嵌入数据时是非常好的选择。

## 结论

对于可逆信息隐藏技术，嵌入容量和嵌入后图像质量是相当重要的指标，也是目前进一步开发RDH技术的重点方向，为进一步提升RDH方案的性能和实用性,可以从以下几个方面去开展。

1. 提升压缩数据的性能。 在RDH技术中往往需要采用压缩技术对相关数据进行压缩以增加冗余空间嵌入更高容量的数据。
2. 对彩色图像RDH技术进行研究。到目前为止,针对灰度图像的RDH技术已非常成熟,而针对彩色图像的RDH技术较少。
3. 对压缩域图像开展研究。当前, 大多数RDH技术主要针对的是未压缩图像。然而,在日常生活中,为节约存储空间和传输带宽,压缩后的图像更实用。
4. 与人工智能合作。深度学习技术已在多个领域被成功应用。因此,研究人员在设计RDH算法时可以尝试将深度学习技术引入到 RDH 中来以进一步提升嵌入算法的性能。
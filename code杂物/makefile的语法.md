# makefile入门

makefile用以定义一个工程的编译规则。一个工程中充满了复杂的文件结构，对于build的顺序和详细设置也有开发者自己的考量，我们就需要makefile作为与编译器沟通的门户。
makefile的本质是执行定义的命令，并不会关心命令如何执行，相当于代开发者之笔在命令行输入指令。

* 总述

1. 默认情况下makefile 的第一个目标是终极目标。
2. 依赖： 目标文件需要由哪些文件生成。
3. 命令： 通过执行文件由依赖文件生成目标文件，每条命令要求有一个tab保持缩进。
4. all: Makefile文件默认只生成第一个目标文件即完成编译，但是我们可以通过all指定需要生成的文件。

* 基本结构

makefile的规则如下所示：
>
> ```makefile
> target : prerequisites
> command
> ```

`target`是目标文件，可以是Object File，也可以是执行文件，还可以是一个标签（不懂）。
`prerequisites`就是，要生成的target所需要的文件或是目标。
`command`也就是make要执行的命令。

* 变量

使用`$`来取变量的值，变量名多于一个字符，使用"()"。
一些其他符号的表示：
`$^`表示所有的依赖文件
`$@`表示生成的目标文件
`$<`代表第一个依赖文件

预定义变量：
> `CC = gcc`
使用`CC`代指c编译器的名称。
> `@echo "clean done!"`
回显问题，Makefile中的指令都会被打印出来，如果不想打印出来命令部分，可以使用`@`去除回显。

* 工作方式

make会首先在工程目录下寻找名字叫Makefile或者makefile的文件。
如果能够找到，它会寻找文件中的第一个目标文件，把这个文件作为最终的目标文件。
如果依赖文件不存在，或是依赖文件的修改时间要比当前目标文件新，他会执行后面的命令生成目标文件。
如此往下遍历，直到最终满足生成目标文件的条件并生成目标文件。

GNU的manke非常强大，它可以自动推导文件自己文件依赖关系后面的命令，当make看到一个`.o`文件时，他就会自动把同名的`.c`加在依赖关系之中。

* 使用赋值

使用"="进行赋值，变量的值是整个Makefile中最后被制定的值（即当右边的式子中有变量的引用时，引用的是全局中该变量的最终值）
使用":="对左边变量赋予当前位置等号右边的值（与"="相对）
使用"?="表示如果被赋值变量没有被赋过值（截止到执行当前表达式为止），赋值予等号右边的值。


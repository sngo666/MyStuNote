# 基本移位指令

* 逻辑移位和算术移位

移动操作数的方式共有两种。逻辑移位指的是发生移位时，空出来的位用0填充。使用算术移位时，空出来的位用原数据的符号位填充。

* SHL指令

SHL（左移）指令使目的操作数左移一位，最低位用0填充。最高位移入进位标志位CF，进位标志位中的原数据被丢弃。使用格式如下:
>
> ```asm
> SHL destination, count
> ```
>
其中count是执行移位的次数，count可以是立即数（0~255）或是CL寄存器（包含的是移位计数）。
上述格式同样适用于SHR, SAL, SAR, ROR, ROL, RCR和RCL指令。
当一个数进行多次位移后，进位标志位中的数由最后一次执行位移决定。

* SHR指令

格式和用法同指令SHL，使操作数右移一位，最高位用0填充，最低位复制到进位标志位。

* SAL指令与SAR指令

SAL（算术左移）与SHL指令一样，每次移动时，SAL都将目的操作数中每一位移动到下一位，最低位用0填充，最高位进入进位标志位。SAL与SAR指令的操作数类型与与SHL和SHR完全相同。
区别在于SAR进行位移的时候，空出来的位使用原先的符号位填充。（所以是算术位移）。使用SAR就可以对有符号数进行操作数除法。

* ROL指令和ROR指令

以循环方式来移位即为位元循环，此种循环指的是从数一端移出的位立刻填充到数的另一端。还有一种类型是把进位标志位当做是移动位的中间点。
使用ROL指令把所有位都向左移，最高位复制进标志位和最低位，该指令格式与SHL指令相同。多次循环时与SHL规则相同。
ROR指令则是将操作数循环右移，其他同理。

* RCL和RCR指令

RCL（带进位循环左移）指令把每一位都向左移，进位标志位复制到LSB（最低位），简单来说，就是把进位标志位拼在最高位左边，然后进行整体循环左移。
RCL可以用以恢复之前移入进位标志位的位。
RCR则是以同样的方式进行右移操作。

* 有符号数溢出

如果有符号数循环移动一位导致其超过了有符号数的范围，则在原有基础上将溢出标志位置1。判断依据：符号位被改变。

* SHLD与SHRD指令

SHLD为双精度左移指令，用以将目的操作数(desti)向左移动指定位数(count)，移动形成的空位由源操作数(source)最高位替补。格式如下：
> `SHLD desti, source, count`

而对于SHRD来说，相当于将源操作数拼在目的操作数左边，然后对目的操作数进行右移，接着将源操作数的最低位补入目的操作数（相应的位数）。

* 移位与循环移位的应用

1. 数组的位移
使用数组保存整数时，字节与字节之间仍然是小端顺序，当我们对数组整体进行移位时，使用CF进位标志位作为沟通两个字节之间的衔接，最大字节向右移动时，多出的位保存在CF标志位中，再利用RCR将进位标志位移入下一个字节，下一个字节多处的位移入进位标志位。

2. 二进制乘法
一个例子说明：EAX *5 = EAX* (2^2 + 2^0)
(第一次看恍然大悟)

3. 显示二进制位
使用SHL指令左移将位复制进缓冲区。

4. 提取文件日期字段
系统常常将多个字段打包为一个整数，获得这些数据就要提取`位串`的位序列并使用移位函数在寄存器中处理。

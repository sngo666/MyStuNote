# 乘除法与扩展加减法

32位模式下，整数乘法可以实现32，16，8位的操作，MUL指令和IMUL指令分别执行有符号数和无符号数乘法。DIV和IDIV同理。

* MUL指令

32位模式下，MUL（无符号数乘法）指令有三种类型：

1. 执行8位操作数与AL寄存器的乘法。
2. 执行16位操作数与AX寄存器的乘法。
3. 执行32位操作数与EAX寄存器的乘法。
上述三种形式可以使用寄存器和内存，但是不能使用立即数（MUL是一元运算符）。即使用哪种情况取决了操作数的位数。
AL与寄存器/内存产生的乘积存放在AX中，AX参与产生的乘积存放在DX:AX中，EAX参与产生的乘积存放在EDX:EAX中。如果乘积的高半部分不为0，则会将进位标志位和溢出标志位置1。我们通常用这种方式检测乘积的数据宽度。

对于64位模式中，有RAX参与的乘法产生的128位乘积存放在RDX:RAX中。

* IMUL指令

与MUL不同，IMUL会保留乘数的符号，实现的方法是将乘积低半部分的最高位符号位扩展到高半部分，x86指令集支持三种格式的IMUL指令，即一至三个操作数。
单操作数模式中，乘积存放方式与MUL指令相同。
双操作数模式中（32位模式）将乘积存放在第一个操作数中，第二个寄存器可以是寄存器（第一个操作数的位数)、内存（第一个操作数的位数)或是操作数(8位或第一个操作数的位数)。在这种情况下，结果会按照目标操作数的大小来截取乘积，如果被丢弃的是有效位，则将溢出标志位和进位标志位置1。
三操作数中，将第二、第三个操作数相乘，保存在第一个操作数中，位数和操作数类型可以为以下组合：
|  reg  | mem/reg |  imm  |
| :---: | :-----: | :---: |
|  16   |   16    |   8   |
|  16   |   16    |  16   |
|  32   |   32    |   8   |
|  32   |   32    |  32   |

在以前的处理器上调佣MUL与SHL，MUL所花的时间是移位的二至三倍，但在近期的处理器上测试，二者消耗的时间差别不大。

* DIV指令

32位模式下，DIV（无符号除法）执行8位，16位以及32位无符号除法。单寄存器或内存操作数是除数。

| 被除数  |   除数    |  商   | 余数  |
| :-----: | :-------: | :---: | :---: |
|   AX    | reg/mem8  |  AL   |  AH   |
|  DX:AX  | reg/mem16 |  AX   |  DX   |
| EDX:EAX | reg/mem32 |  EAX  |  EDX  |

有符号除法与无符号除法几乎相同，区别在于在执行除法之前，必须对被除数进行符号扩展。符号扩展是指将一个数的最高位复制到包含该数的变量或寄存器的所有高位中。
可以通过使用CWD（字转双字）对被除数进行符号扩展。
例：
-101 -> 009Bh
-> FFFFFF9Bh

* 符号扩展指令
CBW（字节转字）指令将AL的符号位扩展到AH。
CWD（字转双字）指令将AX的符号位扩展到DX。
CDQ（双字转四字）指令将EAX的符号位扩展到EDX。

* IDIV指令

IDIV指令（有符号除法），执行八位除法之前，除数必须完成符号扩展，格式使用方法tongDIV指令。
尽量使用32位除数和64位被除数减少出现除法溢出条件的可能性。

## 扩展加减法

* ADC指令

ADC（带进位加减法）将源操作数和进位标志位的值都与目的操作数相加，指令格式同ADD（不能使用两个内存操作数）。
抽象上相当于三个数相加（两个加数和进位标志位）。

* SBB指令

带借位减法指令从目的操作数中减去源操作数和进位标志位的值，允许使用的操作数与ADC指令相同。


## ASCII和非压缩十进制运算

虽然CPU执行的是二进制运算，但是也可以用于执行ASCII十进制串的运算，有四类指令专门用于对ASCII加减乘除法运算。
尽管ASCII运算速度慢于二进制运算，但是它不必在执行运算之前转换串格式。
ASCII的非压缩十进制整数每个字节的高四位总是为0，而ASCII十进制数的高四位是0011b，例：
对于十进制数3402，表现形式如下：
ASCII格式：33 34 30 32
非压缩格式： 03 04 00 02

* AAA指令

在32位模式下，AAA（加法后的ASCII调整）指令调整ADD或ADC指令的二进制运算结果，使用方法如下例子所示：
>
> ```asm
> mov ah, 0
> mov al, '8'
> add al, '2'
> aaa
> or ax,3030h
> ```

最后一步or将结果AX=0100h转为ASCII格式3030h。


* AAS指令

减法后的ASCII调整指令紧跟在SUB或者SBB指令之后，并将结果保存在AL中，只有结果为负的时候，调整才是必要的。

* AAM指令

32位模式下，MUL执行的是非压缩十进制乘法，AAM（乘法后的ASCII调整）指令转换由其产生的二进制乘积，乘法只能使用非压缩十进制数。

* AAM指令
  
非压缩除法，其他同上。

懒得细看，有用再品。

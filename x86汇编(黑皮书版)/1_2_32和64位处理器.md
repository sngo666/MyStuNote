# 1.2  32位和64位处理器

## 32位处理器

 x86处理器总共有三个主要的操作模式，为保护模式、实地址模式以及系统管理模式，此外还有个保护模式的特殊模式：虚拟8086模式。

* 保护模式(PM)：保护模式为处理的原生模式，此模式中所有的指令和特性都是可用的。分配给程序的独立内存区被称为段，处理器会阻止程序使用自身范围之外的内存。

* 虚拟8086模式(V-8086M)：处理器可以处在一个安全的环境中直接执行实地址模式软件。

* 实地址模式(R-AM)：用于让程序直接访问系统内存和硬件设备，也增加了能够切换到其他模式的特性。

* 系统管理模式(SMM)：向操作系统提供了一些额外的功能机制，通常用于特定系统设计的处理器。

&emsp;

## 基本执行环境

 地址空间：一个任务/程序最大可以寻址4GB的线性地址空间。
 基本程序执行寄存器：8个通用寄存器，6个段寄存器，1个处理状态标志寄存器(EFLAGS)和1个指令指针寄存器(EIP)。

|32位|(低)16位|(高)8位|(低)8位|
|:----:|:----:|:----:|:----:|
|EAX|AX|AH|AL|
|EBX|BX|BH|BL|
|ECX|CX|CH|CL|
|EDX|DX|DH|DL|

|32位|(低)16位|
|:----:|:----:|
|ESP|SP|
|ESI|SI|
|EBP|BP|
|EDI|DI|

 特殊用法：
 1.乘除指令默认用的是EAX，EAX常常被称作扩展累加器寄存器。
 2.CPU默认使用ECX作为循环计数器。
 3.ESP用于寻址堆栈，极少用于一般算术运算和数据传输，通常被称为扩展堆栈指针寄存器。
 4.ESI与EDI用于高速存储器传输指令，有时被称作扩展源变址寄存器和扩展目的变址寄存器。
 5.高级语言通过EBP引用堆栈中的函数参数和局部变量。除了高级编程，一般不用于算术运算和数据传输。被称作扩展帧指针寄存器。

 段寄存器

* 实地址模式：段寄存器表示的是预先分配的的内存区域的基址。
* 保护模式：存放的是段描述符表指针，一些段存放指令代码，一些段存放变量数据，还有一个堆栈段存放的是局部变量和函数参数。

指令指针寄存器(EIP)
包含下一条要执行指令的地址，机器指令能够控制EIP。

EFLAGS寄存器
该寄存器包含了独立的二进制位，用于控制CPU的操作。(Set:1  Reset:0)

MMX寄存器
8个64位MMX寄存器称为SIMD(单指令多数据)的指令，MMX寄存器名实际上是浮点单元中使用的同样寄存器的别名。

XMM
x86结构还包含了8个128位XMM寄存器，被用于SIMD流扩展指令集。

内存管理

* 实地址模式：只能寻址1MB内存，处理器一次只能运行一个程序，但是可以经由中断处理外围设备的请求，应用程序被允许访问内存的任意位置。
* 保护模式：可以同时运行多个程序，为每个程序分配最多4GB的内存，程序之间禁止访问其他程序代码和数据。
虚拟8086模式：计算机运行在保护模式下，可以同时运行多个8086虚拟机器。

### 64位处理器

>当前处理器只能支持48位的地址

64位操作系统引入一个包含两个子模式的新模式——IA-32e。
1.兼容模式：现有的16位与32位程序不需要重新编译就可以运行。
2.64位模式：在该模式下，处理器执行的是使用64位线性地址空间的应用程序，也是64位Microsoft windows的原生模式。

&emsp;

64位操作系统与32位操作系统的区别
|系统|64位|32位|
|:----:|:----:|:----:|
|通用寄存器|16个64位|8个32位|
|状态标志位寄存器|64位RFLAGS(只使用低32位)|32位EFLAGS|
|XMM寄存器|16个128位|8个128位|

### 一些细节

* 64位模式下，单条指令不能同时访问寄存器高字节，如AH等。以及新字节寄存器的低字节，如DIL等。
* 64位模式下，EFLAGS由64位RFLAGS取代，这两个寄存器共享低位，但是高位不使用。
* 32位与64位具有相同的标志状态。

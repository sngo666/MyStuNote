# chapter-11 Texture Mapping

对于纹理的映射本质上是一个重采样过程，因而很容易导致混叠伪影现象。纹理系统的复杂性便是来源于解决此类问题。

## 查找纹理坐标

我们需要一个函数，该函数从表面映射到我们可以很容易地为每个像素计算的纹理。
这是纹理坐标函数，其应当满足从表面坐标(x, y, z)到纹理坐标(u, v)的转换。

基本纹理映射中的两个主要问题：
• 定义纹理坐标函数
• 在不引入太多混叠的情况下查找纹理值。

## 纹理坐标函数

3D坐标的形状千变万化，大多数情况下，可能都非常难以“展开”成一个2D平面。
考虑以下几种特性：

双极性：大部分情况下，希望曲面坐标和纹理坐标可以双向映射。
尺寸失真：纹理的比例在整个曲面上应该近似恒定。也就是说，曲面上任何相距大约相同距离的点都应该映射到纹理中相距大约相同的点。
形状失真：纹理不应该非常扭曲。也就是说，在曲面上绘制的小圆应该映射到纹理空间中合理的圆形，而不是极度挤压或拉长的形状。
连续性：曲面上的相邻点应映射到纹理中的相邻点。

* 平面投影

这也是从3D到2D最简单的变换，仅需要通过简单的矩阵相乘，这种情况下，我们多半希望
从数学角度来看，大抵就是：

$$
\phi(x,y,z) = (u, v) where \begin{bmatrix}
u \\ v \\ * \\ 1
\end{bmatrix} = M_t \begin{bmatrix}
x \\ y \\ z \\ 1
\end{bmatrix}
$$

$M_t$代表一种仿射变换。

* 球面投影

球体上任一点的坐标可以用纬度/经度参数化来表示，不过问题在于两极处附近会有一些失真。

对于球面坐标的降维，可以通过将xyz三维坐标转换为参数方程，并将球面半径r弃用，可以得到：

$$
\phi(x, y, z) = ((\pi + atan2(y, x))/2\pi, (\pi - acos(z/||x||))/\pi)
$$

* 圆柱投影

对于柱状物体，可能使用圆柱投影更合适一些
类似的，降维的依据来源于放弃半径。

$$
\phi(x, y, z) = (\frac{1}{2\pi}(\pi + atan2(y, x))/2\pi, \frac{1}{2}(1+z))
$$

* 立方体投影

虽然使用立方体投影看会导致面与面之间的边缘会引入不连续性，但是可以有效解决球体两极采样失真的问题。

对于立方投影来说，计算每一面的纹理坐标的成本要远低于计算球面坐标，其本质类似于透视投影：

$$
(x, y ,z) \rightarrow (\frac{x}{z}, \frac{y}{z})
$$

问题在于指定一个标准去定义u和v的方向以表示六个面。

### 插值纹理坐标

通过关键点上的纹理值以及三角形内部的插值公式，对于任一点内部的像素进行插值计算。

当纹理空间中三角形的面积与其在3D中的面积成比例时，大小失真较低。

### 平铺、环绕模式和纹理变换

有时我们想要一个重复的图案，比如棋盘、瓷砖地板或砖墙。如果图案在矩形网格上重复，那么创建具有相同数据的多个副本的图像将是浪费。相反，我们可以使用环绕索引来处理纹理图像之外的纹理查找——当查找点离开纹理图像的右边缘时，它会环绕到左边缘。

## 透视校正插值

通过在三角形之间插值纹理坐标来实现正确的透视图有一些微妙之处，但我们可以在光栅化阶段解决这个问题。
事情并不简单的原因是，仅仅在屏幕空间中插值纹理坐标就会导致不正确的图像: 透视图中的东西随着与观看者的距离增加而变小，所以在3D中均匀间隔的线应该在2D图像空间中压缩。为了实现这一点，需要对纹理坐标进行更仔细的插值。

仅仅使用简单的插值公式去计算光栅空间中的纹理插值是错误的。


# chapter-09 Signal Processing

一般来说，计算机中很难存储一个连续的函数，只能存储一段采样点来表示。

## 数字音频：1D采样

在音频记录中，麦克风将空气中作为压力波存在的声音转换为时变电压，该电压相当于麦克风所在点处不断变化的空气压力的测量值。
扬声器通过与电压同步地移动隔膜将电压转换回压力波。

### Artifacts和Aliasing

图像或图形中的其他采样信号也会出现同样的欠采样和重建伪影，解决方案是相同的：在采样前进行滤波，在重建过程中再次进行滤波。
在图像中，aliasing通常以摩尔纹的形式出现。

## 卷积

卷积是一个很简单的数学概念。
卷积是对函数的一种操作:它取两个函数并将它们组合以产生一个新函数。

$$
f * g
$$

### 移动平均

为了在任何点获得平滑值，我们计算在每个方向上延伸一个距离的范围内的函数的平均值。距离r称为平滑操作的半径，是一个控制平滑程度的参数：

$$
h(x) = \frac{1}{2r} \int^{x+r}_{x-r} g(t)dt
$$

对于离散函数的采样也是类似的：

$$
c[i] = \frac{1}{2r+1} \sum^{i+r}_{j=i-r} a[j]
$$

### 离散卷积

将离散序列$a[i]$与另一个离散序列$b[i]$卷积。结果是一个离散序列：

$$
(a*b)[i] = \sum_j a[j]b[i-j]
$$

回顾移动平均，也可以将b序列看作是一个加权区内权值内完全相等的序列，其权值取决于加权区的宽幅。
引申地说，卷积滤波器通常被设计为它们的和为1。

卷积运算满足交换律，结合律和分配律。

对于序列d[i] = ..0,0,1,0,0,...
与其进行卷积操作返回原序列本身。

### 具有连续函数的卷积

$$
(f*g)(x) = \int^{+\infty}_{-\infty} f(t)g(x-t)dt
$$

另一种写法：

$$
(f*g)(x) = \int^{+\infty}_{-\infty} f(t)g_{\rightarrow t}dt
$$

对离散卷积形式同理：

$$
(a*b)[i] = \sum_j a[j]b_{\rightarrow j}
$$

### 狄拉克德尔塔函数(狄拉克德尔塔函数)

直观地说，delta函数是一个非常窄、非常高的尖峰，其宽度极小，但面积仍等于1的函数
如果满足这样的定义：

$$
d * a = a
$$

可以称之为Dirac impulse或者Dirac delta function，表示为$\delta(x)$

$$
\int^{+\infty}_{-\infty} \delta(x)f(t)dt = f(0)
$$

且有：

$$
(\delta*f)(x) = \int^{+\infty}_{-\infty} \delta(t)f(x-t)dt
$$

### 离散连续卷积函数

连接离散世界和连续世界有两种方法。
一种是采样：我们通过在所有整数参数上写下函数的值并忘记其余部分，将连续函数转换为离散函数。

另一方面，从离散函数或序列到连续函数称为重构。这是通过另一种形式的卷积来实现的，即离散连续形式。

$$
(a*b)(x) = \sum_i a[i]f(x-i)
$$

### 二维卷积

$$
(f * g)(x, y) = \int \int f(x', y')g(x - x', y - y')dx'dy'
$$

$$
(a * f)(x, y) = \sum_i \sum_j a[i, j]f(x-i, y-j)
$$

## 卷积滤波器

在本节中，过滤器以这个自然大小定义：
盒过滤器的自然半径为$\frac{1}{2}$， 块过滤器的自然半径为$2$
此外，每个过滤器满足$\int_{x=1}^{+\infty} f(x)dx = 1$

一些应用程序需要不同大小的过滤器，这可以通过缩放基本过滤器来获得。对于过滤器$f (x)$，我们可以定义尺度$s$的一个版本：

$$
f_s(x) = \frac{f(x/s)}{s}
$$

相当于垂直压缩s倍，然后水平拉伸$\frac{1}{s}$倍。

### 盒过滤器(box filter)

盒滤波器(图9.19)是一个分段常数函数，其积分等于1。作为离散滤波器：

$$
a_{box,r}[i] = \begin{cases}
1/(2r+1)& |i|\le r, \\
0 & otherwise
\end{cases}
$$

连续的也类似。

### 帐篷过滤器(tent filter)

$$
f_{tent}(x) = \begin{cases}
1 - |x| & |x|\le 1, \\
0 & otherwise
\end{cases}
$$

### 高斯滤波器(The Gaussian Filter)

高斯是一个很好的采样滤波器，因为它非常平滑.

$$
f_{g,\sigma}(x) = \frac{1}{\sigma \sqrt{2\pi}}e^{-x^2/2\sigma^2}
$$

### $f_B$(B-Spline三次过滤器)

$$
f_B(x) = \frac{1}{6} \begin{cases}
-3(1-|x|)^3 + 3(1-|x|)^2 + 3(1-|x|) + 1 & -1\le x \le 1 \\
(2-|x|)^3 & 1 \le |x| \le 2, \\
0 & otherwise
\end{cases}
$$

$f_B(x)$具有连续的一阶导数和二阶导数，定义为$C^2$

### Catmull-Rom三次滤波器

在x=−2、−1、1和2时的值为零，且在x=0时为1

$$
f_C(x) = \frac{1}{2} \begin{cases}
-3(1-|x|)^3 + 4(1-|x|)^2 + (1-|x|) & -1\le x \le 1 \\
(2-|x|)^3 - (2-|x|)^2 & 1 \le |x| \le 2, \\
0 & otherwise
\end{cases}
$$

### Mitchell-Netravali三次滤波器

$$
\begin{aligned}
f_C(x) &= \frac{1}{3}f_B(x) + \frac{2}{3} f_C(x) \\ &= \frac{1}{18} \begin{cases}
-21(1-|x|)^3 + 27(1-|x|)^2 + 9(1-|x|) + 1 & -1\le x \le 1 \\
7(2-|x|)^3 - 6(2-|x|)^2 & 1 \le |x| \le 2, \\
0 & otherwise
\end{cases}
\end{aligned}
$$

### 滤波器的属性

如果连续滤波器用于从离散序列重构连续函数时，得到的函数恰好取采样点处的样本值，即它“连接点”，而不是生成一个只靠近点的函数，那么它就是插值滤波器。
插值滤波器函数对于所有的非零整数i都满足$f(0) = 1,f(i) = 0$

如果连续滤波器用作重建滤波器时，它将把常数序列重建为常数函数，则它是无波纹的.

如果有必要消除离散连续卷积中的波纹，那么很容易做到：将每个计算的样本除以用于计算它的权重之和：

### 可分离滤波器

大多数情况下，我们可以从我们已经看到的1D滤波器中构建合适的2D（或更高维）滤波器。

$$
f_2(x,y) = f_1(x)f_1(y)
$$

$$
b_2[i,j] = b_1[i]b_1[j]
$$

## 图像中的信号处理

### 使用离散滤波器进行图像滤波

高斯滤波器创建了一个非常平滑的模糊，通常用于图像的模糊。

基于模糊的相反面，锐化可以借助于这样的思想来进行.
类似的，可以使用位运算来为图像生成阴影。

### 图像采样中的抗锯齿

如果我们在没有任何特殊测量的情况下继续对图像进行采样，结果将显示出各种混叠伪影。
在图像的尖锐边缘，我们看到被称为“锯齿”的阶梯伪影，其实是摩尔纹。

这里的问题是图像包含太多的小尺度特征；我们需要在采样前对其进行滤波以使其平滑。
高斯滤波器非常平滑，对莫尔条纹图案更有效，但总体上会更加模糊。这是选择抗混叠滤波器的基础。

### 重建和重采样

考虑调整图像大小的方法是重新采样操作：

* 对于放大图像，首先，我们从输入样本(原图像)重构一个连续函数。
然后我们对该函数进行采样，就像对任何其他连续图像进行采样一样。
为了避免混叠伪影，需要在每个阶段使用适当的过滤器。

* 对于缩小图像，如果原始图像是12×9像素，而新图像是8×6像素，则每个维度的输出像素是输入像素的2/3，因此它们在图像上的间距是原始样本间距的3/2。
像素衰减算法为我们提供了一种方法：只需取输入图像中最接近的样本的值，并将其作为输出值。

根据卷积计算的结合律，对于离散样本首先进行的重建以及后来的平滑两个阶段的操作可以合并成一个滤波器，我们称之为重采样滤波器。

对于重建，我们希望滤波器足够平滑，以避免在放大图像时出现混叠伪影，并且滤波器应该是波纹折射的。对于采样，滤波器应该足够大以避免欠采样，并且足够平滑以避免莫尔条纹伪影。

选择过滤器本身是速度和质量之间的权衡。常见的选择是box滤波器（当速度至关重要时）、tent滤波器（中等质量）或分段三次滤波器（优秀质量）
在分段三次的情况下，可以通过在$f_B$和$f_C$之间进行插值来调整平滑度；Mitchell-Netravali滤波器是一个不错的选择。
最后，与图像滤波一样，可分离滤波器可以提供显著的加速。

## 采样理论

### 傅里叶变换

傅立叶变换背后的基本思想是通过将所有频率的正弦波（正弦曲线）相加来表达任何函数。通过对不同的频率使用适当的权重，我们可以安排正弦曲线相加为我们想要的任何（合理的）函数。


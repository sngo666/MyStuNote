# 第四章 高级加密标准

尽管3DES能够抵抗利用当前技术发起的蛮力攻击，但它仍然存在一些问题，一方面其软件实现并不高效，DES本就不适合软件实现，3DES更是需要三倍的时间之多。第二个缺点就是分组相对较小，一般分组都是64位，因此我们引入AES。

## AES算法概述

AES密码与分组密码Rijndael基本上完全一致，分组大小和密码大小都可以是128位，192位和256位。然而AES标准只要求分组大小为128位，因此只有分组长度为128位的Rijndael才称为AES算法。

AES密钥长度和轮数的关系如下：
| 密钥长度 | 轮数  |
| :------: | :---: |
|  128位   |  10   |
|  192位   |  12   |
|  256位   |  14   |

与DES相比，单轮的AES就在议论中加密了所有位，这也是AES为什么比DES轮数少的原因。除了第一轮外，每一轮都由三层组成，即字节代换层->扩散层->密钥加法层，第一层只有密钥加法层。在扩散层中分为shiftRows层和MixColumn层，但是最后一轮没有MixColumn层。下面简单介绍每一层。

1. 密钥加法层：128位轮密钥来源于密钥编排中的主密钥，它将与状态进行异或操作。
2. 字节代换层：即S-盒，状态中的每个元素都使用具有特殊数学属性的查找表进行非线性变换。这种方法将混淆引入数据中，即它可以保证对单个状态位的修改可以迅速传播到整个数据路径中。
3. 扩散层： 为所有状态位提供扩散，由两个子层组成，每个子层都在执行线性操作。

* ShiftRows(行移位变化)层在位级别进行数据置换。
* MixColumn(列混淆变换)是一个混淆操作，它合并(混合)了长度为四个字节的分组。

## 伽罗瓦域

有限域有时候也被成为伽罗瓦域，他指的是拥有有限个元素的集合，在了解域之前先简要了解域的概念。
定义:

> 群指的是元素集合G及G内任意两个元素的联合操作@的结合。具有以下特性。  
> 群操作是封闭的，即对于任意两个群内元素进行该操作得出的结果依然属于该群。  
> 群操作是满足结合律的。  
> 存在一个元素1在群内，对于所有的群内元素a满足a@1 = 1@a。此元素1称为中性元(或单位元)。  
> 对每个群内元素a都存在一个元素a^(-1)处于群内，使得a@a^(-1) = a^(-1)@a = 1,那么a^(-1)就称为a的逆元。  
> 在以上所有特性的基础上，如果对所有的群内元素a和b都有a@b = b@a，则称此群为阿贝尔群。

概括来说，群就是一个操作以及对应逆操作的集合。如果该操作为加法，那么对应的逆操作就是减法，如果该操作是乘法，那么其逆操作是除法。

* 域

为了使一种结构同时支持四种基本算术运算(加减乘除),我们需要一个同时包含加法与乘法的集合，也就是我们常说的域(field).
定义：

> 域是拥有以下特性的元素的集合。  
> F中所有元素形成一个加法群，对应的群操作为+，中性元为0。  
> F中除0外的所有元素构成一个乘法群，对应的群操作为*，中性元为1。  
> 当混合使用这两种群操作时，分配定理始终成立，即对于所有a,b,c都在群内，有a(b+c) = ab + ac

在密码编码学中，我们基本上只对拥有有限个元素的域感兴趣，而这样的域也被称为有限域或者伽罗瓦域。域所包含的元素的个数被称为域的阶或基。
_定理_：只有当m是一个素数幂时，即m = p^n (p为素数, n为正整数。)，阶为m的域才存在，p称为这个域的特征。

* 素域

有限域最直观的例子就是阶为素数的域，即n=1的域。域GF(p)的元素可以用整数0，1...p-1来表示。域的两种操作就是模整数加法和整数乘法模p。
_定理_：假设p是一个素数，整数环Zp表示为GF(p),也称为是拥有素数个元素域或伽罗瓦域。GF(p)中所有非零元素都存在逆元，GF(p)中所有的非零元素都存在逆元，GF(p)内的算术运算都是模p实现的。

整数环不仅是一个环，也是一个有限域。为了在素域中进行算术运算，我们必须遵循整数环的以下规则：加法和乘法都必须通过模p实现，任何一个元素a的加法逆元由`a+(-a) = 0 mod p`给出；任何一个非零元素a的乘法逆元定义为`a * a^(-1) = 1 mod p`。
(0的乘法逆元不存在)

GF(2)是重要的素域，也是最小的有限域。

* 扩展域GF(2^m)

在AES中包含256个元素的有限域可以表示为GF(2^8)，选择这个有限域的原因是该有限域中的每个元素都可以用一个字节表示。在S-盒和MixColumn变换中，AES将内部数据路径的每个字节均表示为域中的一个元素，并利用此有限域中的算术运算符操作数据。

m>1的域称为扩展域，为了处理扩展域，我们需要:

1. 使用不同的符号表示此域内的元素。
2. 使用不同的规则执行此域内的元素的运算。

我们使用多项式表示扩展域的元素，并且扩展域内的计算也是通过某种多项式运算得到的。在AES使用的域中，每个元素都可以表示为：
A(x) = a7x^7 + ... + a1x + a0

使用系数为域GF(2)中元素的多项式，并生成相应的系数向量。

* GF(2^m)的加法与减法

AES的密钥加法层使用了加法，扩展域中的加法与减法都十分简单，通过标准的多项式加法与减法即可得到，实际上，仅需要将幂次相同的系数进行加减即可。完成加减法之后要模2。

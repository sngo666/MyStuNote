# Simulating Ocean Water

## 海洋环境的辐射

海洋环境仅仅包含四个组件：水面、空气、太阳和低于表面的水体积。
相机看到的光取决于光源到达水体表面和进入相机的光束，除了从表面反射直射阳光和天空外，还有一部分入射光通过表面透射。最终，一小部分透射光被水散射，穿过界面进入空气。一些在表面反射或折射的光可能会第二次照射到表面，产生更多的反射和折射事件。
但是过多次数的折射和反射会导致过高的运算负荷，所以将忽略来自表面水体超过一次以上的反射和折射。

在表面以上环境中的任何一点，包括在相机处，来自任何方向的总光强(辐射)有三个因素:

$$
L_{ABOVE} = rL_{S} + rL_{A} + t_UL_{U}
$$

分开介绍这几个组成的定义：
$r$是**菲涅尔反射率**，用于描述从海洋表面的一个点到相机的反射过程。
$t_{U}$是来自海洋体积的光$L_{U}$的**透射系数**，在表面被折射进入相机。
$L_S$是来自太阳的直射光，通过大气，到达海洋表面的点，在那里被表面反射到镜头。
$L_A$是(漫射)大气天光。
$L_{U}$是在地表下通过地表进入空气的光。

该方程隐藏了对空间位置和光行进方向的依赖，原则上$L_S$, $L_A$和$L_{U}$必然存在复杂的依赖关系。
且先不谈，先给出太阳的直射光：

$$
L_S = L_{TOA}e^{-\tau}
$$

$L_{TOA}$是太阳光直射到大气层的intensity，$\tau$是阳光方向和地球上的点的大气层的光学厚度

漫射大气天光$L_A$和上升流光$L_{U}$都可以写成两个项的总和：

$$
L_A = L^0_A(L_S) + L_A^1(L_U)
$$

$$
L_U = L^0_U(L_S) + L_A^1(L_A)
$$

这些方程揭示了问题的潜在复杂性。虽然$L_A$和$L_{U}$都依赖于阳光直射，但它们也相互依赖。
例如，穿透海洋的光总量来自阳光直射和大气阳光。一些进入海洋的光被海洋中的颗粒和分子散射，返回大气层。一些上升流的光反过来被散射到大气中，成为了漫反射天光的一部分。这也是老生常谈的问题。
需要注意的是上升流光$L_{U}$可能比较难以计算，因为其来自体积多重散射。

解决方法是让天光值依赖来自于太阳的直射光，并用一个基于海洋科学观测的经验公式完全取代$L_{U}$方程，这个经验公式只依赖于直射阳光和其他一些决定水类型和清晰度的参数。

我们定义水下的辐射方程:

$$
L_{BELOW} = tL_{D} + tL_{I} + L_{SS} + L_M
$$

分开介绍这几个组成的定义：
$t$是在水面上的每个点和角度处透射通过水面的**菲涅耳透射率**。
$L_D$表示穿透到水中的来自太阳的**直射光**。
$L_I$表示穿透到水中的来自大气层的**间接光**。
$L_{SS}$表示来自太阳和大气的**单次散射光**，指的是在到达任何一点之前已在水体中发生过一次散射。
$L_M$表示**多次散射的光**。这是在体积中经历更多散射事件的单个散射光。

上述水的情况一样，这些术语都是以相对复杂的方式相互关联的。例如，单次散射光取决于直接光和间接光：

$$
L_{SS} = P(tL_I) + P(tL_D)
$$

$P$是其参数的线性泛函算子，包含有关单散射事件和散射光从散射处传递到相机的衰减信息。接着我们以同样的方式对多重散射建模：

$$
L_{M} = G(tL_I) + G(tL_D)
$$

我们可以说多重散射其实就是单次散射的连锁，所以将上述两个算子进行组合：

$$
\begin{aligned}
G &\sim P \otimes P \otimes (1 + P + \frac{1}{2!}P \otimes P + \frac{1}{3!} P \otimes P \otimes + ...) \\
&\sim  P \otimes P \otimes exp(P)
\end{aligned}
$$

在这里，鉴于其复杂性，我们暂时不给出类卷积算子的详细定义$\otimes$。

## 相关数学、物理问题和实验

### 伯努利方程

海洋表面运动数学公式的起点是不可压缩的Navier-Stokes方程。

流体在任何位置$x$、任何时间t的速度$\bold{u}(x, t)$的不可压缩Navier-Stokes方程为:

$$
\frac{\partial{\bold{u}}}{\partial t} + \bold{u} \cdot \triangledown \bold{u} = -\triangledown p + \bold{F}
$$

$$
\triangledown \cdot \bold{u}(x, t) = 0
$$

使用$p(x, t)$表示流体表面的压力，$\bold{F}(x, t)$是施加到流体表面的力。
